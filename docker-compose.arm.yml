services:
  webcam-recorder:
    build:
      context: .
      dockerfile: Dockerfile.arm
    ports:
      - "5000:5000"
    volumes:
      # Mount recordings directory to persist recordings
      - ./recordings:/app/recordings
    # Optional: Uncomment to use custom .env file
    #  - ./.env:/app/.env:ro
    devices:
      # Grant access to webcam devices
      # On Raspberry Pi, typically /dev/video0
      - /dev/video0:/dev/video0
    environment:
      - FLASK_ENV=production
      - DEBUG=False
      - HOST=0.0.0.0
      - PORT=5000
      # Reduce workers for Raspberry Pi (limited resources)
      # Recommended: 2 workers for Raspberry Pi 3/4
      - WORKERS=2
      - CAMERA_INDEX=0
      # Lower resolution settings for better performance on Raspberry Pi
      - CAMERA_WIDTH=640
      - CAMERA_HEIGHT=480
      - CAMERA_FPS=30
    restart: unless-stopped
    networks:
      - webcam-network

networks:
  webcam-network:
    driver: bridge
